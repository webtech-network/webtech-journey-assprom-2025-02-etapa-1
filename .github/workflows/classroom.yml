name: Autograder

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  grading:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check repository criteria
        run: |
          score=0
          maxScore=100
          baseScore=100
          
          # Verificar se a branch main existe
          if git show-ref --verify --quiet refs/heads/main; then
            echo "‚úÖ Branch 'main' existe. +25 pontos"
            ((score+=25))
          else
            echo "‚ùå Branch 'main' n√£o encontrada."
          fi
          
          # Verificar se h√° pelo menos um commit no reposit√≥rio
          if [ $(git rev-list --count HEAD) -gt 0 ]; then
            echo "‚úÖ Pelo menos um commit encontrado. +25 pontos"
            ((score+=25))
          else
            echo "‚ùå Nenhum commit encontrado."
          fi
          
          # Verificar se h√° um arquivo chamado resumo.txt
          if [ -f "resumo.txt" ]; then
            echo "‚úÖ Arquivo 'resumo.txt' encontrado. +25 pontos"
            ((score+=25))
            
            # Verificar se o arquivo cont√©m pelo menos tr√™s linhas
            if [ $(wc -l < resumo.txt) -ge 3 ]; then
              echo "‚úÖ 'resumo.txt' cont√©m pelo menos tr√™s linhas. +25 pontos"
              ((score+=25))
            else
              echo "‚ùå 'resumo.txt' n√£o cont√©m pelo menos tr√™s linhas."
            fi
          else
            echo "‚ùå Arquivo 'resumo.txt' n√£o encontrado."
          fi

          # Gerar relat√≥rio
          echo ""
          echo "-------- üìè Detalhes de Pontua√ß√£o --------"
          echo "üìä Pontua√ß√£o base: $score"
          echo "üî∫ Bonifica√ß√£o: 0"
          echo ""
          echo "-------- üìè Regras de Pontua√ß√£o --------"
          echo " Nota base com itens requeridos: $baseScore, M√≠nimo: 0, M√°ximo: $maxScore"
          echo "‚ö†Ô∏è Itens requeridos: 1 branch 'main', pelo menos 1 commit, arquivo 'resumo.txt' e pelo menos 3 linhas dentro dele."
          echo "üîπ Cada crit√©rio atendido vale 25 pontos."
          echo "üî∫ Pontua√ß√£o M√°xima: $maxScore"
          exit 0
